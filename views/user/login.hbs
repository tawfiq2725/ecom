<section class="login-page">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <div class="block text-center">
                    <h2 class="text-center">Login</h2>
                    {{#if success_msg}}
                    <div class="alert alert-success">{{success_msg}}</div>
                    {{/if}}
                    {{#if error_msg}}
                    <div class="alert alert-danger">{{error_msg}}</div>
                    {{/if}}
                    {{#if errors}}
                    {{#each errors}}
                    <div class="alert alert-danger">{{this.msg}}</div>
                    {{/each}}
                    {{/if}}
                    <form id="loginForm" action="/auth/login" method="post">
                        <div class="form-group">
                            <input type="email" class="form-control" name="email" placeholder="Email">
                            <small class="error-message text-danger"></small>
                        </div>
                        <!-- Password Field with Toggle Icon -->
                        <div class="form-group">
                            <div class="input-container position-relative">
                                <input type="password" class="form-control" name="password" placeholder="Password" id="password">
                                <i class="fa fa-eye position-absolute" id="togglePassword" style="cursor: pointer; right: 10px; top: 50%; transform: translateY(-50%);"></i>
                            </div>
                            <small class="error-message text-danger"></small>
                        </div>
                        <button type="submit" class="btn btn-primary">Login</button>
                    </form>
                    <p>Don't have an account? <a href="/signup">Register here</a></p>
                    <p><a href="/forgot-pass">Forgot Password</a></p>
                    <hr>
                    <div class="form-group">
                        <a href="/auth/google" class="btn btn-primary">Sign in with Google</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        // Prevent form submission
        e.preventDefault();

        // Clear previous error messages
        document.querySelectorAll('.error-message').forEach(function(el) {
            el.textContent = '';
        });
        document.querySelectorAll('.form-control').forEach(function(el) {
            el.style.borderColor = '';
        });

        // Get form fields
        var email = document.querySelector('input[name="email"]');
        var password = document.querySelector('input[name="password"]');

        var isValid = true;

        // Email validation
        var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        if (!emailPattern.test(email.value.trim())) {
            email.nextElementSibling.textContent = 'Please enter a valid email address.';
            email.style.borderColor = 'red';
            isValid = false;
        } else {
            email.style.borderColor = 'green';
        }

        // Password validation (minimum 8 characters, at least one letter and one number)
        var passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
        if (!passwordPattern.test(password.value.trim())) {
            password.nextElementSibling.textContent = 'Password must 8 char';
            password.style.borderColor = 'red';
            isValid = false;
        } else {
            password.style.borderColor = 'green';
        }

        if (isValid) {
            // If the form is valid, submit it
            this.submit();
        }
    });

    // Toggle password visibility
    document.getElementById('togglePassword').addEventListener('click', function() {
        var passwordInput = document.getElementById('password');
        var icon = this;
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    });
</script>

<style>
    .error-message {
        font-size: 0.875em;
        color: red;
        margin-top: 0.25em;
    }
    .position-relative {
        position: relative;
    }

    .position-absolute {
        position: absolute;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .input-container + .error-message {
        margin-top: 0.5rem;
    }
</style>

<div class="content-body">
    <div class="container-fluid">
        <h2>Add Product</h2>
        <div id="error-message" class="alert alert-danger" style="display:none;"></div>
        <form id="addProductForm" action="/admin/products/add" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">Product Name</label>
                <input type="text" name="name" id="productName" class="form-control" >
                <small id="productNameError" class="form-text text-danger" style="display:none;"></small>
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <textarea name="description" id="productDescription" class="form-control" ></textarea>
                <small id="productDescriptionError" class="form-text text-danger" style="display:none;"></small>
            </div>
            <div class="form-group">
                <label for="price">Price</label>
                <input type="number" name="price" id="productPrice" class="form-control" >
                <small id="productPriceError" class="form-text text-danger" style="display:none;"></small>
            </div>
            <div class="form-group">
                <label for="category">Category</label>
                <select name="category" id="productCategory" class="form-control" >
                    {{#each categories}}
                    <option value="{{this._id}}">{{this.name}}</option>
                    {{/each}}
                </select>
                <small id="productCategoryError" class="form-text text-danger" style="display:none;"></small>
            </div>
            <div class="form-group">
                <label for="highlights">Highlights (comma-separated)</label>
                <input type="text" name="highlights" id="productHighlights" class="form-control">
            </div>
            <div class="form-group">
                <label for="mainImage">Main Image</label>
                <input type="file" id="mainImage" name="mainImage" class="form-control" >
                <img id="main-cropped-image" src="#" alt="Cropped Image" style="display:none;">
                <small id="mainImageError" class="form-text text-danger" style="display:none;"></small>
            </div>
            <div class="form-group">
                <label for="subImages">Additional Images</label>
                <input type="file" id="subImages" name="subImages" class="form-control" multiple>
                <div id="subImagePreviews" class="mt-2"></div>
                <button type="button" class="btn btn-danger" id="clearSubImages" style="display:none;">Clear Sub Images</button>
            </div>
            <!-- Add Variant Section -->
            <div id="variant-container">
                <div class="form-group variant-box">
                    <h5>Variant 1</h5>
                    <label for="variant-size-0">Size</label>
                    <input type="text" name="variants[0][size]" id="variantSize0" class="form-control" >
                    <small id="variantSizeError0" class="form-text text-danger" style="display:none;"></small>
                    <label for="variant-stock-0">Stock</label>
                    <input type="number" name="variants[0][stock]" id="variantStock0" class="form-control" >
                    <small id="variantStockError0" class="form-text text-danger" style="display:none;"></small>
                </div>
            </div>
            <button type="button" class="btn btn-secondary" id="add-variant">Add Variant</button>
            <div id="variant-limit-message" class="text-danger" style="display:none;">Maximum 6 variants allowed</div>

            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>
    </div>
</div>
<script>
    document.getElementById('addProductForm').addEventListener('submit', function(event) {
    event.preventDefault();
    let isValid = true;

    const name = document.getElementById('productName').value.trim();
    const description = document.getElementById('productDescription').value.trim();
    const price = document.getElementById('productPrice').value;
    const category = document.getElementById('productCategory').value;
    const mainImage = document.getElementById('mainImage').files[0];
    const subImages = document.getElementById('subImages').files;

    const nameError = document.getElementById('productNameError');
    const descriptionError = document.getElementById('productDescriptionError');
    const priceError = document.getElementById('productPriceError');
    const categoryError = document.getElementById('productCategoryError');
    const mainImageError = document.getElementById('mainImageError');

    nameError.style.display = 'none';
    descriptionError.style.display = 'none';
    priceError.style.display = 'none';
    categoryError.style.display = 'none';
    mainImageError.style.display = 'none';

    const alphaRegex = /^[A-Za-z\s]+$/;
    const numericRegex = /^[0-9]+(\.[0-9]{1,2})?$/;

    if (!name) {
        isValid = false;
        nameError.textContent = 'Product Name is required';
        nameError.style.display = 'block';
    } else if (!alphaRegex.test(name)) {
        isValid = false;
        nameError.textContent = 'Product Name must contain only alphabets';
        nameError.style.display = 'block';
    }

    if (!description) {
        isValid = false;
        descriptionError.textContent = 'Description is required';
        descriptionError.style.display = 'block';
    }

    if (!price) {
        isValid = false;
        priceError.textContent = 'Price is required';
        priceError.style.display = 'block';
    } else if (!numericRegex.test(price)) {
        isValid = false;
        priceError.textContent = 'Price must be a valid number';
        priceError.style.display = 'block';
    }

    if (!category) {
        isValid = false;
        categoryError.textContent = 'Category is required';
        categoryError.style.display = 'block';
    }

    if (!mainImage) {
        isValid = false;
        mainImageError.textContent = 'Main Image is required';
        mainImageError.style.display = 'block';
    }

    for (let i = 0; i < subImages.length; i++) {
        if (!subImages[i]) {
            isValid = false;
            const subImageError = document.createElement('small');
            subImageError.className = 'form-text text-danger';
            subImageError.textContent = 'Each sub image is required';
            subImageError.style.display = 'block';
            document.getElementById('subImagePreviews').appendChild(subImageError);
        }
    }

    // Validate variants
    for (let i = 0; i < variantCount; i++) {
        const variantSize = document.getElementById(`variantSize${i}`).value.trim();
        const variantStock = document.getElementById(`variantStock${i}`).value.trim();

        const variantSizeError = document.getElementById(`variantSizeError${i}`);
        const variantStockError = document.getElementById(`variantStockError${i}`);

        variantSizeError.style.display = 'none';
        variantStockError.style.display = 'none';

        if (!variantSize) {
            isValid = false;
            variantSizeError.textContent = 'Size is required';
            variantSizeError.style.display = 'block';
        }

        if (!variantStock) {
            isValid = false;
            variantStockError.textContent = 'Stock is required';
            variantStockError.style.display = 'block';
        } else if (!numericRegex.test(variantStock)) {
            isValid = false;
            variantStockError.textContent = 'Stock must be a valid number';
            variantStockError.style.display = 'block';
        }
    }

    if (isValid) {
        this.submit();
    } else {
        document.getElementById('error-message').textContent = 'Please fix the errors above and try again.';
        document.getElementById('error-message').style.display = 'block';
    }
});

</script>